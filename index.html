<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Tracker Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="min-h-screen bg-slate-900 text-white m-0 p-0">
    <!-- Overlay pour fermer la sidebar -->
    <div id="sidebar-overlay" class="sidebar-overlay" onclick="closeSidebar()"></div>
    
    <!-- Sidebar compacte avec nouveau style -->
    <nav id="sidebar" class="sidebar closed">
        <!-- Header de la sidebar avec style amélioré -->
        <div class="sidebar-header">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg">
                    <i data-lucide="dumbbell" class="w-6 h-6 text-white"></i>
                </div>
                <div>
                    <span class="sidebar-title">Workout Tracker</span>
                    <div class="text-xs text-slate-400 mt-1">Version Pro</div>
                </div>
            </div>
        </div>
        
        <!-- Navigation principale avec animations -->
        <div class="sidebar-navigation">
            <button onclick="navigateTo('home'); closeSidebar();" id="sidebar-home-btn" class="sidebar-nav-item active fade-in">
                <div class="sidebar-nav-icon">
                    <i data-lucide="home" class="w-6 h-6"></i>
                </div>
                <span class="sidebar-nav-text">Accueil</span>
            </button>
            
            <button onclick="navigateTo('workout'); closeSidebar();" id="sidebar-workout-btn" class="sidebar-nav-item fade-in" style="animation-delay: 0.1s;">
                <div class="sidebar-nav-icon">
                    <i data-lucide="dumbbell" class="w-6 h-6"></i>
                </div>
                <span class="sidebar-nav-text">Entraînement</span>
            </button>
            
            <button onclick="navigateTo('stats'); closeSidebar();" id="sidebar-stats-btn" class="sidebar-nav-item fade-in" style="animation-delay: 0.2s;">
                <div class="sidebar-nav-icon">
                    <i data-lucide="trending-up" class="w-6 h-6"></i>
                </div>
                <span class="sidebar-nav-text">Statistiques</span>
            </button>
            
            <button onclick="exportData(); closeSidebar();" class="sidebar-nav-item fade-in" style="animation-delay: 0.3s;">
                <div class="sidebar-nav-icon">
                    <i data-lucide="download" class="w-6 h-6"></i>
                </div>
                <span class="sidebar-nav-text">Exporter</span>
            </button>
        </div>
        
        <!-- Paramètres en bas avec nouveau style -->
        <div class="sidebar-bottom">
            <button onclick="toggleSettings(); closeSidebar();" class="sidebar-settings-item">
                <div class="sidebar-nav-icon">
                    <i data-lucide="settings" class="w-6 h-6"></i>
                </div>
                <span class="sidebar-nav-text">Paramètres</span>
            </button>
        </div>
    </nav>
    
    <!-- Container principal -->
    <div class="app-container">
        <!-- Header principal avec style glassmorphism -->
        <header class="main-header">
            <div class="flex items-center justify-between px-6 py-4">
                <div class="flex items-center space-x-4">
                    <!-- Bouton hamburger amélioré -->
                    <button onclick="toggleSidebar()" id="hamburger-btn" class="hamburger-btn hover-lift">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>
                    
                    <h1 class="text-xl font-bold text-white gradient-text">Workout Tracker</h1>
                    
                    <span class="week-badge hover-glow">
                        <i data-lucide="calendar" class="w-4 h-4"></i>
                        Semaine <span id="current-week">1</span>
                    </span>
                </div>
            </div>
        </header>

        <!-- Contenu principal avec animations -->
        <main id="main-content" class="main-content fade-in">
            <!-- Pages will be dynamically loaded here -->
        </main>
    </div>

    <!-- Loading Indicator amélioré -->
    <div id="loading" class="fixed inset-0 bg-slate-900 bg-opacity-75 flex items-center justify-center hidden z-50 backdrop-blur-sm">
        <div class="glass rounded-xl p-8 flex items-center space-x-4 shadow-2xl">
            <div class="loading-spinner"></div>
            <span class="text-lg font-medium">Chargement...</span>
        </div>
    </div>

    <!-- Toast notifications améliorées -->
    <div id="toast" class="toast">
        <div class="flex items-center space-x-3">
            <i data-lucide="check-circle" class="w-5 h-5 flex-shrink-0"></i>
            <span id="toast-message" class="font-medium">Action réussie</span>
        </div>
    </div>

    <!-- Scripts dans le bon ordre -->
    <script src="config.js"></script>
    <script src="router.js"></script>
    <script src="app.js"></script>
    <script src="pages/home.js"></script>
    <script src="pages/workout.js"></script>
    <script src="pages/stats.js"></script>
    
    <script>
        // Gestion de la sidebar - AMÉLIORÉE avec animations
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            const btn = document.getElementById('hamburger-btn');
            
            console.log('Toggle sidebar - État actuel:', sidebar.classList.contains('closed') ? 'fermé' : 'ouvert');
            
            if (sidebar.classList.contains('closed')) {
                // Ouvrir avec animation
                sidebar.classList.remove('closed');
                sidebar.classList.add('open');
                overlay.classList.add('show');
                btn.classList.add('active');
                
                // Animer les items de navigation
                const navItems = sidebar.querySelectorAll('.sidebar-nav-item');
                navItems.forEach((item, index) => {
                    setTimeout(() => {
                        item.style.transform = 'translateX(0)';
                        item.style.opacity = '1';
                    }, index * 50);
                });
                
                console.log('Sidebar ouverte avec animations');
            } else {
                // Fermer
                closeSidebar();
            }
        }
        
        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            const btn = document.getElementById('hamburger-btn');
            
            sidebar.classList.remove('open');
            sidebar.classList.add('closed');
            overlay.classList.remove('show');
            btn.classList.remove('active');
            
            console.log('Sidebar fermée');
        }
        
        // Fermer avec Escape (inchangé)
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeSidebar();
            }
        });
        
        // Fonction pour les paramètres avec toast amélioré
        function toggleSettings() {
            showToast('Paramètres - Fonctionnalité à venir', 'info');
        }
        
        // Mettre à jour la navigation active avec animations
        function updateSidebarNavigation(activePage) {
            const items = document.querySelectorAll('.sidebar-nav-item');
            items.forEach(item => {
                item.classList.remove('active');
                // Animation de sortie
                item.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    item.style.transform = 'scale(1)';
                }, 150);
            });
            
            const activeItem = document.getElementById(`sidebar-${activePage}-btn`);
            if (activeItem) {
                setTimeout(() => {
                    activeItem.classList.add('active');
                    // Animation d'entrée
                    activeItem.style.transform = 'scale(1.05)';
                    setTimeout(() => {
                        activeItem.style.transform = 'scale(1)';
                    }, 200);
                }, 100);
            }
        }
        
        // Toast amélioré avec types et animations
        function showToastImproved(message, type = 'success', duration = 3000) {
            const toast = document.getElementById('toast');
            const messageEl = document.getElementById('toast-message');
            const iconEl = toast.querySelector('i');
            
            if (toast && messageEl) {
                messageEl.textContent = message;
                
                // Changer l'icône selon le type
                iconEl.setAttribute('data-lucide', 
                    type === 'success' ? 'check-circle' :
                    type === 'error' ? 'x-circle' :
                    type === 'info' ? 'info' : 'check-circle'
                );
                
                // Mettre à jour les classes
                toast.className = `toast ${type}`;
                
                // Réinitialiser les icônes Lucide
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
                
                // Animation d'entrée
                toast.classList.add('show');
                
                // Animation de sortie
                setTimeout(() => {
                    toast.classList.remove('show');
                }, duration);
            }
        }
        
        // Remplacer la fonction showToast globale
        window.showToast = showToastImproved;
        
        // Initialisation avec animations
        document.addEventListener('DOMContentLoaded', () => {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.add('closed');
            
            // Animation d'entrée de la page
            const mainContent = document.getElementById('main-content');
            mainContent.style.opacity = '0';
            mainContent.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                mainContent.style.transition = 'all 0.6s ease';
                mainContent.style.opacity = '1';
                mainContent.style.transform = 'translateY(0)';
            }, 100);
            
            console.log('Sidebar initialisée fermée avec animations');
            
            // Précharger les animations
            const animatedElements = document.querySelectorAll('.fade-in, .slide-up');
            animatedElements.forEach((el, index) => {
                el.style.animationDelay = `${index * 0.1}s`;
            });
        });
        
        // Animation au changement de page
        function animatePageTransition() {
            const mainContent = document.getElementById('main-content');
            mainContent.style.opacity = '0';
            mainContent.style.transform = 'translateY(10px)';
            
            setTimeout(() => {
                mainContent.style.opacity = '1';
                mainContent.style.transform = 'translateY(0)';
            }, 150);
        }
        
        // Raccourcis clavier améliorés
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 's':
                        e.preventDefault();
                        showToast('Données sauvegardées automatiquement', 'success');
                        break;
                    case 'e':
                        e.preventDefault();
                        exportData();
                        break;
                    case '1':
                        e.preventDefault();
                        navigateTo('home');
                        break;
                    case '2':
                        e.preventDefault();
                        navigateTo('workout');
                        break;
                    case '3':
                        e.preventDefault();
                        navigateTo('stats');
                        break;
                }
            }
        });
        
        // Animation des progress bars au chargement
        function animateProgressBars() {
            const progressBars = document.querySelectorAll('.progress-fill');
            progressBars.forEach((bar, index) => {
                const targetWidth = bar.style.width || bar.getAttribute('data-width') || '0%';
                bar.style.width = '0%';
                
                setTimeout(() => {
                    bar.style.width = targetWidth;
                }, 500 + (index * 100));
            });
        }
        
        // Appeler l'animation des progress bars après le chargement du contenu
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.type === 'childList') {
                    setTimeout(animateProgressBars, 200);
                }
            });
        });
        
        observer.observe(document.getElementById('main-content'), {
            childList: true,
            subtree: true
        });
    </script>
</body>
</html>